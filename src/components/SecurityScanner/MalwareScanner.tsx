
import React, { useState } from 'react';
import { Shield } from 'lucide-react';
import ScanForm from './MalwareScanner/ScanForm';
import ScanResults from './MalwareScanner/ScanResults';
import ScanningIndicator from './MalwareScanner/ScanningIndicator';
import { useMalwareScan } from './MalwareScanner/useMalwareScan';

const MalwareScanner = () => {
  const [url, setUrl] = useState('');
  const {
    startScan,
    clearScan,
    isScanning,
    scanResult,
    scanError,
    isFetching
  } = useMalwareScan();

  const scanUrl = () => {
    if (!url.trim()) return;
    startScan({ url });
  };

  const resetScan = () => {
    setUrl('');
    clearScan();
  };

  const hasResults = scanResult && !isScanning && !isFetching;
  const isScanActive = isScanning || isFetching;
  const scanId = scanResult?.scanId;
  
  return (
    <div className="rounded-xl glass-card p-6 border border-cyber-purple/20">
      <div className="flex flex-col items-center text-center max-w-2xl mx-auto">
        <div className="rounded-full bg-cyber-purple/10 p-4 mb-4">
          <Shield className="h-8 w-8 text-cyber-purple" />
        </div>
        <h2 className="text-xl font-semibold text-white mb-2">Malware URL Scanner</h2>
        <p className="text-gray-400 mb-6">
          Enter a URL to scan for malware, phishing, and other security threats using VirusTotal.
        </p>
        
        {!scanId ? (
          <ScanForm 
            url={url} 
            setUrl={setUrl} 
            scanning={isScanActive} 
            onScan={scanUrl} 
          />
        ) : isScanActive ? (
          <ScanningIndicator />
        ) : (
          <ScanResults 
            scanResults={scanResult} 
            onScanAnother={resetScan} 
          />
        )}
      </div>
    </div>
  );
};

export default MalwareScanner;
